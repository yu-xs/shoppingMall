import{D as _,aj as _e,L as R,ap as ie,E as p,R as N,an as J,a8 as K,r as $,am as Ie,y as B,O as Ce,P as Q,aL as Me,Z as Se,f as m,ao as ue,aa as de,W as L,J as q,a9 as Re,H as we,aM as Fe,a1 as j,aN as te,ar as Te,a4 as ce,ax as G,U as Oe,aO as He,K as W,aP as Ne,aE as pe,T as ne,Y as Le,aG as Z,F as Ue,aH as ke,aQ as je,x as Ye,aR as Ke,w as ae,v as le,Q as me,ae as ze,B as qe}from"./index-c14d0632.js";const[Ge,M,fe]=_("picker"),De=e=>e.find(t=>!t.disabled)||e[0];function Qe(e,t){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(t.children in a)return"cascade"}return"default"}function X(e,t){t=ie(t,0,e.length);for(let a=t;a<e.length;a++)if(!e[a].disabled)return a;for(let a=t-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const ve=(e,t,a)=>t!==void 0&&!!e.find(s=>s[a.value]===t);function re(e,t,a){const s=e.findIndex(v=>v[a.value]===t),l=X(e,s);return e[l]}function We(e,t,a){const s=[];let l={[t.children]:e},v=0;for(;l&&l[t.children];){const d=l[t.children],C=a.value[v];if(l=_e(C)?re(d,C,t):void 0,!l&&d.length){const b=De(d)[t.value];l=re(d,b,t)}v++,s.push(d)}return s}function Je(e){const{transform:t}=window.getComputedStyle(e),a=t.slice(7,t.length-1).split(", ")[5];return Number(a)}function Ze(e){return R({text:"text",value:"value",children:"children"},e)}const he=200,ge=300,Xe=15,[xe,oe]=_("picker-column"),Ve=Symbol(xe);var et=p({name:xe,props:{value:N,fields:J(Object),options:K(),readonly:Boolean,allowHtml:Boolean,optionHeight:J(Number),swipeDuration:J(N),visibleOptionNum:J(N)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:a}){let s,l,v,d,C;const b=$(),o=$(),u=$(0),T=$(0),y=Ie(),O=()=>e.options.length,A=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,x=g=>{let n=X(e.options,g);const c=-n*e.optionHeight,f=()=>{n>O()-1&&(n=X(e.options,g));const F=e.options[n][e.fields.value];F!==e.value&&t("change",F)};s&&c!==u.value?C=f:f(),u.value=c},i=()=>e.readonly||!e.options.length,S=g=>{s||i()||(C=null,T.value=he,x(g),t("clickOption",e.options[g]))},k=g=>ie(Math.round(-g/e.optionHeight),0,O()-1),V=B(()=>k(u.value)),D=(g,n)=>{const c=Math.abs(g/n);g=u.value+c/.003*(g<0?-1:1);const f=k(g);T.value=+e.swipeDuration,x(f)},I=()=>{s=!1,T.value=0,C&&(C(),C=null)},r=g=>{if(!i()){if(y.start(g),s){const n=Je(o.value);u.value=Math.min(0,n-A())}T.value=0,l=u.value,v=Date.now(),d=l,C=null}},w=g=>{if(i())return;y.move(g),y.isVertical()&&(s=!0,ue(g,!0));const n=ie(l+y.deltaY.value,-(O()*e.optionHeight),e.optionHeight),c=k(n);c!==V.value&&t("scrollInto",e.options[c]),u.value=n;const f=Date.now();f-v>ge&&(v=f,d=n)},h=()=>{if(i())return;const g=u.value-d,n=Date.now()-v;if(n<ge&&Math.abs(g)>Xe){D(g,n);return}const f=k(u.value);T.value=he,x(f),setTimeout(()=>{s=!1},0)},P=()=>{const g={height:`${e.optionHeight}px`};return e.options.map((n,c)=>{const f=n[e.fields.text],{disabled:F}=n,z=n[e.fields.value],Ae={role:"button",style:g,tabindex:F?-1:0,class:[oe("item",{disabled:F,selected:z===e.value}),n.className],onClick:()=>S(c)},$e={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:f};return m("li",Ae,[a.option?a.option(n,c):m("div",$e,null)])})};return Ce(Ve),Q({stopMomentum:I}),Me(()=>{const g=s?Math.floor(-u.value/e.optionHeight):e.options.findIndex(f=>f[e.fields.value]===e.value),n=X(e.options,g),c=-n*e.optionHeight;s&&n<g&&I(),u.value=c}),Se("touchmove",w,{target:b}),()=>m("div",{ref:b,class:oe(),onTouchstartPassive:r,onTouchend:h,onTouchcancel:h},[m("ul",{ref:o,style:{transform:`translate3d(0, ${u.value+A()}px, 0)`,transitionDuration:`${T.value}ms`,transitionProperty:T.value?"all":"none"},class:oe("wrapper"),onTransitionend:I},[P()])])}});const[tt]=_("picker-toolbar"),ee={title:String,cancelButtonText:String,confirmButtonText:String},nt=["cancel","confirm","title","toolbar"],at=Object.keys(ee);var lt=p({name:tt,props:ee,emits:["confirm","cancel"],setup(e,{emit:t,slots:a}){const s=()=>{if(a.title)return a.title();if(e.title)return m("div",{class:[M("title"),"van-ellipsis"]},[e.title])},l=()=>t("cancel"),v=()=>t("confirm"),d=()=>{const b=e.cancelButtonText||fe("cancel");return m("button",{type:"button",class:[M("cancel"),de],onClick:l},[a.cancel?a.cancel():b])},C=()=>{const b=e.confirmButtonText||fe("confirm");return m("button",{type:"button",class:[M("confirm"),de],onClick:v},[a.confirm?a.confirm():b])};return()=>m("div",{class:M("toolbar")},[a.toolbar?a.toolbar():[d(),s(),C()]])}});const[ot,$t]=_("picker-group"),st=Symbol(ot);R({tabs:K(),activeTab:L(0),nextStepText:String},ee);const Ee=R({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:L(44),showToolbar:q,swipeDuration:L(1e3),visibleOptionNum:L(6)},ee),it=R({},Ee,{columns:K(),modelValue:K(),toolbarPosition:Re("top"),columnsFieldNames:Object});var ct=p({name:Ge,props:it,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:t,slots:a}){const s=$(),l=$(e.modelValue.slice(0)),{parent:v}=Ce(st),{children:d,linkChildren:C}=we(Ve);C();const b=B(()=>Ze(e.columnsFieldNames)),o=B(()=>Fe(e.optionHeight)),u=B(()=>Qe(e.columns,b.value)),T=B(()=>{const{columns:n}=e;switch(u.value){case"multiple":return n;case"cascade":return We(n,b.value,l);default:return[n]}}),y=B(()=>T.value.some(n=>n.length)),O=B(()=>T.value.map((n,c)=>re(n,l.value[c],b.value))),A=B(()=>T.value.map((n,c)=>n.findIndex(f=>f[b.value.value]===l.value[c]))),x=(n,c)=>{if(l.value[n]!==c){const f=l.value.slice(0);f[n]=c,l.value=f}},i=()=>({selectedValues:l.value.slice(0),selectedOptions:O.value,selectedIndexes:A.value}),S=(n,c)=>{x(c,n),u.value==="cascade"&&l.value.forEach((f,F)=>{const z=T.value[F];ve(z,f,b.value)||x(F,z.length?z[0][b.value.value]:void 0)}),ce(()=>{t("change",R({columnIndex:c},i()))})},k=(n,c)=>{const f={columnIndex:c,currentOption:n};t("clickOption",R(i(),f)),t("scrollInto",f)},V=()=>{d.forEach(c=>c.stopMomentum());const n=i();return ce(()=>{t("confirm",n)}),n},D=()=>t("cancel",i()),I=()=>T.value.map((n,c)=>m(et,{value:l.value[c],fields:b.value,options:n,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:o.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:f=>S(f,c),onClickOption:f=>k(f,c),onScrollInto:f=>{t("scrollInto",{currentOption:f,columnIndex:c})}},{option:a.option})),r=n=>{if(y.value){const c={height:`${o.value}px`},f={backgroundSize:`100% ${(n-o.value)/2}px`};return[m("div",{class:M("mask"),style:f},null),m("div",{class:[He,M("frame")],style:c},null)]}},w=()=>{const n=o.value*+e.visibleOptionNum,c={height:`${n}px`};return m("div",{ref:s,class:M("columns"),style:c},[I(),r(n)])},h=()=>{if(e.showToolbar&&!v)return m(lt,Oe(G(e,at),{onConfirm:V,onCancel:D}),G(a,nt))};j(T,n=>{n.forEach((c,f)=>{c.length&&!ve(c,l.value[f],b.value)&&x(f,De(c)[b.value.value])})},{immediate:!0});let P;return j(()=>e.modelValue,n=>{!te(n,l.value)&&!te(n,P)&&(l.value=n.slice(0),P=n.slice(0))},{deep:!0}),j(l,n=>{te(n,e.modelValue)||(P=n.slice(0),t("update:modelValue",P))},{immediate:!0}),Se("touchmove",ue,{target:s}),Q({confirm:V,getSelectedOptions:()=>O.value}),()=>{var n,c;return m("div",{class:M()},[e.toolbarPosition==="top"?h():null,e.loading?m(Te,{class:M("loading")},null):null,(n=a["columns-top"])==null?void 0:n.call(a),w(),(c=a["columns-bottom"])==null?void 0:c.call(a),e.toolbarPosition==="bottom"?h():null])}}});const Y="000000",rt=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],Pe=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],H=(e="",t=Y,a=void 0)=>({text:e,value:t,children:a});function ut({areaList:e,columnsNum:t,columnsPlaceholder:a}){const{city_list:s={},county_list:l={},province_list:v={}}=e,d=+t>1,C=+t>2,b=()=>{if(d)return a.length?[H(a[0],Y,C?[]:void 0)]:[]},o=new Map;Object.keys(v).forEach(y=>{o.set(y.slice(0,2),H(v[y],y,b()))});const u=new Map;if(d){const y=()=>{if(C)return a.length?[H(a[1])]:[]};Object.keys(s).forEach(O=>{const A=H(s[O],O,y());u.set(O.slice(0,4),A);const x=o.get(O.slice(0,2));x&&x.children.push(A)})}C&&Object.keys(l).forEach(y=>{const O=u.get(y.slice(0,4));O&&O.children.push(H(l[y],y))});const T=Array.from(o.values());if(a.length){const y=C?[H(a[2])]:void 0,O=d?[H(a[1],Y,y)]:void 0;T.unshift(H(a[0],Y,O))}return T}const dt=W(ct),[mt,ft]=_("area"),vt=R({},G(Ee,Pe),{modelValue:String,columnsNum:L(3),columnsPlaceholder:K(),areaList:{type:Object,default:()=>({})}});var ht=p({name:mt,props:vt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:a}){const s=$([]),l=$(),v=B(()=>ut(e)),d=(...o)=>t("change",...o),C=(...o)=>t("cancel",...o),b=(...o)=>t("confirm",...o);return j(s,o=>{const u=o.length?o[o.length-1]:"";u&&u!==e.modelValue&&t("update:modelValue",u)},{deep:!0}),j(()=>e.modelValue,o=>{if(o){const u=s.value.length?s.value[s.value.length-1]:"";o!==u&&(s.value=[`${o.slice(0,2)}0000`,`${o.slice(0,4)}00`,o].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),Q({confirm:()=>{var o;return(o=l.value)==null?void 0:o.confirm()},getSelectedOptions:()=>{var o;return((o=l.value)==null?void 0:o.getSelectedOptions())||[]}}),()=>m(dt,Oe({ref:l,modelValue:s.value,"onUpdate:modelValue":o=>s.value=o,class:ft(),columns:v.value,onChange:d,onCancel:C,onConfirm:b},G(e,Pe)),G(a,rt))}});const gt=W(ht),[bt,yt]=_("form"),Ct={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:N,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:q,showErrorMessage:q,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var St=p({name:bt,props:Ct,emits:["submit","failed"],setup(e,{emit:t,slots:a}){const{children:s,linkChildren:l}=we(Ne),v=i=>i?s.filter(S=>i.includes(S.name)):s,d=i=>new Promise((S,k)=>{const V=[];v(i).reduce((I,r)=>I.then(()=>{if(!V.length)return r.validate().then(w=>{w&&V.push(w)})}),Promise.resolve()).then(()=>{V.length?k(V):S()})}),C=i=>new Promise((S,k)=>{const V=v(i);Promise.all(V.map(D=>D.validate())).then(D=>{D=D.filter(Boolean),D.length?k(D):S()})}),b=i=>{const S=s.find(k=>k.name===i);return S?new Promise((k,V)=>{S.validate().then(D=>{D?V(D):k()})}):Promise.reject()},o=i=>typeof i=="string"?b(i):e.validateFirst?d(i):C(i),u=i=>{typeof i=="string"&&(i=[i]),v(i).forEach(k=>{k.resetValidation()})},T=()=>s.reduce((i,S)=>(i[S.name]=S.getValidationStatus(),i),{}),y=(i,S)=>{s.some(k=>k.name===i?(k.$el.scrollIntoView(S),!0):!1)},O=()=>s.reduce((i,S)=>(S.name!==void 0&&(i[S.name]=S.formValue.value),i),{}),A=()=>{const i=O();o().then(()=>t("submit",i)).catch(S=>{t("failed",{values:i,errors:S}),e.scrollToError&&S[0].name&&y(S[0].name)})},x=i=>{ue(i),A()};return l({props:e}),Q({submit:A,validate:o,getValues:O,scrollToField:y,resetValidation:u,getValidationStatus:T}),()=>{var i;return m("form",{class:yt(),onSubmit:x},[(i=a.default)==null?void 0:i.call(a)])}}});const wt=W(St),[Tt,se]=_("switch"),Ot={size:N,loading:Boolean,disabled:Boolean,modelValue:ne,activeColor:String,inactiveColor:String,activeValue:{type:ne,default:!0},inactiveValue:{type:ne,default:!1}};var kt=p({name:Tt,props:Ot,emits:["change","update:modelValue"],setup(e,{emit:t,slots:a}){const s=()=>e.modelValue===e.activeValue,l=()=>{if(!e.disabled&&!e.loading){const d=s()?e.inactiveValue:e.activeValue;t("update:modelValue",d),t("change",d)}},v=()=>{if(e.loading){const d=s()?e.activeColor:e.inactiveColor;return m(Te,{class:se("loading"),color:d},null)}if(a.node)return a.node()};return pe(()=>e.modelValue),()=>{var d;const{size:C,loading:b,disabled:o,activeColor:u,inactiveColor:T}=e,y=s(),O={fontSize:Le(C),backgroundColor:y?u:T};return m("div",{role:"switch",class:se({on:y,loading:b,disabled:o}),style:O,tabindex:o?void 0:0,"aria-checked":y,onClick:l},[m("div",{class:se("node")},[v()]),(d=a.background)==null?void 0:d.call(a)])}}});const Dt=W(kt),[xt,be]=_("address-edit-detail"),ye=_("address-edit")[2];var Vt=p({name:xt,props:{show:Boolean,rows:N,value:String,rules:Array,focused:Boolean,maxlength:N,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:t}){const a=$(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,l=o=>{t("selectSearch",o),t("input",`${o.address||""} ${o.name||""}`.trim())},v=()=>{if(!s())return;const{searchResult:o}=e;return o.map(u=>m(ke,{clickable:!0,key:(u.name||"")+(u.address||""),icon:"location-o",title:u.name,label:u.address,class:be("search-item"),border:!1,onClick:()=>l(u)},null))},d=o=>t("blur",o),C=o=>t("focus",o),b=o=>t("input",o);return()=>{if(e.show)return m(Ue,null,[m(Z,{autosize:!0,clearable:!0,ref:a,class:be(),rows:e.rows,type:"textarea",rules:e.rules,label:ye("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:ye("addressDetail"),onBlur:d,onFocus:C,"onUpdate:modelValue":b},null),v()])}}});const[Et,U,E]=_("address-edit"),Be={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Pt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:q,showDetail:q,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:N,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:L(1),detailMaxlength:L(200),areaColumnsPlaceholder:K(),addressInfo:{type:Object,default:()=>R({},Be)},telValidator:{type:Function,default:je}};var Bt=p({name:Et,props:Pt,emits:["save","focus","change","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:t,slots:a}){const s=$(),l=Ye({}),v=$(!1),d=$(!1),C=B(()=>Ke(e.areaList)&&Object.keys(e.areaList).length),b=B(()=>{const{province:r,city:w,county:h,areaCode:P}=l;if(P){const g=[r,w,h];return r&&r===w&&g.splice(1,1),g.filter(Boolean).join("/")}return""}),o=B(()=>{var r;return((r=e.searchResult)==null?void 0:r.length)&&d.value}),u=r=>{d.value=r==="addressDetail",t("focus",r)},T=(r,w)=>{t("change",{key:r,value:w})},y=B(()=>{const{validator:r,telValidator:w}=e,h=(P,g)=>({validator:n=>{if(r){const c=r(P,n);if(c)return c}return n?!0:g}});return{name:[h("name",E("nameEmpty"))],tel:[h("tel",E("telInvalid")),{validator:w,message:E("telInvalid")}],areaCode:[h("areaCode",E("areaEmpty"))],addressDetail:[h("addressDetail",E("addressEmpty"))]}}),O=()=>t("save",l),A=r=>{l.addressDetail=r,t("changeDetail",r)},x=r=>{l.province=r[0].text,l.city=r[1].text,l.county=r[2].text},i=({selectedValues:r,selectedOptions:w})=>{r.some(h=>h===Y)?qe(E("areaEmpty")):(v.value=!1,x(w),t("changeArea",w))},S=()=>t("delete",l),k=r=>{l.areaCode=r||""},V=()=>{setTimeout(()=>{d.value=!1})},D=r=>{l.addressDetail=r},I=()=>{if(e.showSetDefault){const r={"right-icon":()=>m(Dt,{modelValue:l.isDefault,"onUpdate:modelValue":w=>l.isDefault=w,onChange:w=>t("changeDefault",w)},null)};return ae(m(ke,{center:!0,border:!1,title:E("defaultAddress"),class:U("default")},r),[[le,!o.value]])}};return Q({setAreaCode:k,setAddressDetail:D}),j(()=>e.addressInfo,r=>{R(l,Be,r),ce(()=>{var w;const h=(w=s.value)==null?void 0:w.getSelectedOptions();h&&h.every(P=>P&&P.value!==Y)&&x(h)})},{deep:!0,immediate:!0}),()=>{const{disableArea:r}=e;return m(wt,{class:U(),onSubmit:O},{default:()=>{var w;return[m("div",{class:U("fields")},[m(Z,{modelValue:l.name,"onUpdate:modelValue":[h=>l.name=h,h=>T("name",h)],clearable:!0,label:E("name"),rules:y.value.name,placeholder:E("name"),onFocus:()=>u("name")},null),m(Z,{modelValue:l.tel,"onUpdate:modelValue":[h=>l.tel=h,h=>T("tel",h)],clearable:!0,type:"tel",label:E("tel"),rules:y.value.tel,maxlength:e.telMaxlength,placeholder:E("tel"),onFocus:()=>u("tel")},null),ae(m(Z,{readonly:!0,label:E("area"),"is-link":!r,modelValue:b.value,rules:e.showArea?y.value.areaCode:void 0,placeholder:e.areaPlaceholder||E("area"),onFocus:()=>u("areaCode"),onClick:()=>{t("clickArea"),v.value=!r}},null),[[le,e.showArea]]),m(Vt,{show:e.showDetail,rows:e.detailRows,rules:y.value.addressDetail,value:l.addressDetail,focused:d.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:V,onFocus:()=>u("addressDetail"),onInput:A,onSelectSearch:h=>t("selectSearch",h)},null),(w=a.default)==null?void 0:w.call(a)]),I(),ae(m("div",{class:U("buttons")},[m(me,{block:!0,round:!0,type:"primary",text:e.saveButtonText||E("save"),class:U("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&m(me,{block:!0,round:!0,class:U("button"),loading:e.isDeleting,text:e.deleteButtonText||E("delete"),onClick:S},null)]),[[le,!o.value]]),m(ze,{show:v.value,"onUpdate:show":h=>v.value=h,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[m(gt,{modelValue:l.areaCode,"onUpdate:modelValue":h=>l.areaCode=h,ref:s,loading:!C.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:i,onCancel:()=>{v.value=!1}},null)]})]}})}}});const _t=W(Bt);export{_t as A};
